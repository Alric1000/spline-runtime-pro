<!-- Add this script to your Webflow page custom code -->
<script>
// Aggressive Pixel Ratio Fix for Webflow
(function() {
    const dpr = window.devicePixelRatio || 1;
    console.log(`[WEBFLOW FIX] Device pixel ratio: ${dpr}`);

    // Fix a specific canvas
    function fixCanvas(canvas) {
        if (!canvas) return false;

        // Get the computed style to find actual display size
        const computedStyle = window.getComputedStyle(canvas);
        const displayWidth = parseFloat(computedStyle.width) || canvas.clientWidth;
        const displayHeight = parseFloat(computedStyle.height) || canvas.clientHeight;

        // Calculate what the buffer size should be
        const bufferWidth = Math.floor(displayWidth * dpr);
        const bufferHeight = Math.floor(displayHeight * dpr);

        // Check if it needs fixing
        if (canvas.width !== bufferWidth || canvas.height !== bufferHeight) {
            console.log(`[WEBFLOW FIX] Fixing ${canvas.id}: ${canvas.width}x${canvas.height} → ${bufferWidth}x${bufferHeight}`);

            // Fix the canvas buffer size
            canvas.width = bufferWidth;
            canvas.height = bufferHeight;

            // Ensure CSS size is set correctly
            canvas.style.width = displayWidth + 'px';
            canvas.style.height = displayHeight + 'px';

            return true;
        }
        return false;
    }

    // Find and fix all Spline canvases
    function fixAllSplineCanvases() {
        const canvasIds = ['allmountain-showcase', 'park-showcase', 'carve-showcase', 'powder-showcase'];
        let fixedCount = 0;

        canvasIds.forEach(id => {
            const canvas = document.getElementById(id);
            if (canvas && fixCanvas(canvas)) {
                fixedCount++;
            }
        });

        // Also try to find canvases by data attribute
        document.querySelectorAll('[data-spline-scene]').forEach(canvas => {
            if (fixCanvas(canvas)) {
                fixedCount++;
            }
        });

        if (fixedCount > 0) {
            console.log(`[WEBFLOW FIX] Fixed ${fixedCount} canvases`);
        }
    }

    // Override the Spline Application to ensure pixel ratio
    function patchSplineApplication() {
        const checkForApp = setInterval(() => {
            // Look for the Application class in various places
            const runtime = window.splineRuntime || window.SPLINE || window.runtime;

            if (runtime && runtime.then) {
                runtime.then(module => {
                    if (module && module.Application && !module.Application.__pixelPatched) {
                        const OrigApp = module.Application;

                        module.Application = function(canvas, options = {}) {
                            // Force pixel ratio in options
                            options.pixelRatio = dpr;
                            console.log(`[WEBFLOW FIX] Creating Application with pixelRatio: ${dpr}`);

                            // Fix canvas before creating app
                            fixCanvas(canvas);

                            // Create the app
                            const app = new OrigApp(canvas, options);

                            // Fix canvas again after creation
                            setTimeout(() => fixCanvas(canvas), 100);
                            setTimeout(() => fixCanvas(canvas), 500);
                            setTimeout(() => fixCanvas(canvas), 1000);

                            return app;
                        };

                        module.Application.__pixelPatched = true;
                        clearInterval(checkForApp);
                        console.log('[WEBFLOW FIX] Application patched successfully');
                    }
                });
            }
        }, 50);

        // Stop checking after 10 seconds
        setTimeout(() => clearInterval(checkForApp), 10000);
    }

    // Run fixes at different stages
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            patchSplineApplication();
            setTimeout(fixAllSplineCanvases, 500);
            setTimeout(fixAllSplineCanvases, 2000);
            setTimeout(fixAllSplineCanvases, 5000);
        });
    } else {
        patchSplineApplication();
        setTimeout(fixAllSplineCanvases, 500);
        setTimeout(fixAllSplineCanvases, 2000);
        setTimeout(fixAllSplineCanvases, 5000);
    }

    // Continuously monitor and fix for the first 10 seconds
    let monitorCount = 0;
    const monitor = setInterval(() => {
        monitorCount++;
        fixAllSplineCanvases();

        if (monitorCount >= 20) { // 20 * 500ms = 10 seconds
            clearInterval(monitor);
            console.log('[WEBFLOW FIX] Monitoring complete');
        }
    }, 500);

    // Add global helper functions
    window.splinePixelFix = {
        check: function() {
            const canvasIds = ['allmountain-showcase', 'park-showcase', 'carve-showcase', 'powder-showcase'];
            canvasIds.forEach(id => {
                const canvas = document.getElementById(id);
                if (canvas) {
                    const computedStyle = window.getComputedStyle(canvas);
                    const displayWidth = parseFloat(computedStyle.width);
                    const displayHeight = parseFloat(computedStyle.height);
                    const expectedWidth = Math.floor(displayWidth * dpr);
                    const expectedHeight = Math.floor(displayHeight * dpr);
                    const correct = (canvas.width === expectedWidth && canvas.height === expectedHeight);

                    console.log(`${id}: ${correct ? '✅' : '❌'} ${canvas.width}x${canvas.height} (should be ${expectedWidth}x${expectedHeight})`);
                }
            });
        },
        fix: function() {
            fixAllSplineCanvases();
            console.log('Manual fix applied');
        },
        getDPR: function() {
            return dpr;
        }
    };

    console.log('[WEBFLOW FIX] Pixel ratio fix installed. Use window.splinePixelFix.check() to diagnose.');
})();
</script>