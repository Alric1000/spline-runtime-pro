<style>
  /* Disable text selection for Spline scenes */
  .type-trigger, .type-trigger *,
  .ski_container, .ski_container *,
  .spinesss, .spinesss *,
  #allmountain-showcase,
  #park-showcase,
  #carve-showcase,
  #powder-showcase {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
  }

  /* Mobile-specific fixes */
  @media (max-width: 768px) {
    .type-trigger, .ski_container, .spinesss {
      -webkit-touch-callout: none !important;
      -webkit-user-select: none !important;
      user-select: none !important;
    }
  }
</style>

<!-- Hover text script -->
<script defer>
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        const span = document.getElementById('typeSpan');
        if (!span) return;

        const defaultText = span.textContent;
        const triggers = document.querySelectorAll('.type-trigger');

        triggers.forEach(el => {
            const value = el.getAttribute('data-type');
            el.addEventListener('mouseenter', () => {
                if (value) span.textContent = value;
            });
            el.addEventListener('mouseleave', () => {
                span.textContent = defaultText;
            });
        });
    }, 100);
});
</script>

<!-- Spline Runtime -->
<script>
document.addEventListener("DOMContentLoaded", async function() {
    const CLOUDFLARE_URL = 'https://spline-runtime-pro.pages.dev';

    // Load runtime once globally
    if (!window.splineRuntime) {
        console.log('Loading Spline runtime...');
        window.splineRuntime = import(`${CLOUDFLARE_URL}/runtime.js`);
    }

    const activeScenes = new Map();
    const loadedScenes = new Set();
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const maxActiveScenes = isMobile ? 2 : 4;
    let currentActiveCount = 0;

    // Scene management
    function pauseScene(canvasId) {
        const app = activeScenes.get(canvasId);
        if (app && app.pause) {
            app.pause();
            console.log(`Paused: ${canvasId}`);
        }
    }

    function resumeScene(canvasId) {
        const app = activeScenes.get(canvasId);
        if (app && app.resume) {
            app.resume();
            console.log(`Resumed: ${canvasId}`);
        }
    }

    // Load scene function
    async function loadSplineScene(canvasId, scenePath) {
        if (loadedScenes.has(canvasId)) {
            resumeScene(canvasId);
            return;
        }

        const canvas = document.getElementById(canvasId);
        if (!canvas) return;

        try {
            console.log(`Loading: ${scenePath}`);
            const { Application } = await window.splineRuntime;

            // Create app with pixel ratio
            const app = new Application(canvas, {
                wasmPath: `${CLOUDFLARE_URL}/`,
                pixelRatio: window.devicePixelRatio || 1,
                antialias: true
            });

            // Load scene
            await app.load(`${CLOUDFLARE_URL}/scenes/${scenePath}/scene.splinecode`);

            // Store app
            activeScenes.set(canvasId, app);
            loadedScenes.add(canvasId);
            currentActiveCount++;

            console.log(`Loaded: ${scenePath}`);
        } catch (error) {
            console.error(`Failed to load ${scenePath}:`, error);
        }
    }

    // Setup intersection observer
    function setupSmartLoading(canvasId, scenePath) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) return;

        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting) {
                if (!loadedScenes.has(canvasId)) {
                    loadSplineScene(canvasId, scenePath);
                } else {
                    resumeScene(canvasId);
                }
            } else {
                if (activeScenes.has(canvasId)) {
                    pauseScene(canvasId);
                }
            }
        }, {
            rootMargin: '100px',
            threshold: 0.1
        });

        observer.observe(canvas);
    }

    // Initialize all scenes
    document.querySelectorAll('[data-spline-scene]').forEach(canvas => {
        const scenePath = canvas.getAttribute('data-spline-scene');
        setupSmartLoading(canvas.id, scenePath);
    });

    console.log(`Found ${document.querySelectorAll('[data-spline-scene]').length} scenes`);
});
</script>