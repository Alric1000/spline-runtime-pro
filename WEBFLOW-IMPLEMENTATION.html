<!-- ============================================
     WEBFLOW IMPLEMENTATION GUIDE
     ============================================ -->

<!-- ============================================
     1. GLOBAL CODE (Project Settings > Custom Code > Head)
     ============================================ -->

<!-- Add this to: Webflow → Project Settings → Custom Code → HEAD Code -->

<style>
/* Global Spline viewer styles */
spline-viewer {
  width: 100%;
  height: 100%;
  display: block;
}

.type-trigger spline-viewer,
.ski_container spline-viewer,
.spinesss spline-viewer {
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  pointer-events: auto;
}
</style>

<!-- Load Spline Viewer from YOUR CDN (loads once for entire site) -->
<script type="module" src="https://spline-runtime-pro.pages.dev/spline-viewer.js"></script>


<!-- ============================================
     2. GLOBAL CODE (Project Settings > Custom Code > Footer)
     ============================================ -->

<!-- Add this to: Webflow → Project Settings → Custom Code → FOOTER Code -->

<script>
document.addEventListener("DOMContentLoaded", function() {
    const CLOUDFLARE_URL = 'https://spline-runtime-pro.pages.dev';

    // Convert all canvas elements to spline-viewer elements
    function initializeSplineViewers() {
        const canvases = document.querySelectorAll('canvas[data-spline-scene]');

        canvases.forEach(canvas => {
            const scenePath = canvas.getAttribute('data-spline-scene');
            if (!scenePath) return;

            // Create spline-viewer element
            const viewer = document.createElement('spline-viewer');
            viewer.setAttribute('url', `${CLOUDFLARE_URL}/scenes/${scenePath}/scene.splinecode`);
            viewer.setAttribute('id', canvas.id);
            viewer.className = canvas.className;

            // Copy all data attributes
            Array.from(canvas.attributes).forEach(attr => {
                if (attr.name.startsWith('data-')) {
                    viewer.setAttribute(attr.name, attr.value);
                }
            });

            // Replace canvas with viewer
            canvas.replaceWith(viewer);
        });

        console.log(`✅ Initialized ${canvases.length} Spline viewers`);
        return canvases.length;
    }

    // Setup lazy loading for performance
    function setupLazyLoading() {
        const viewers = document.querySelectorAll('spline-viewer');
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        const maxActive = isMobile ? 2 : 4;
        let activeCount = 0;

        viewers.forEach(viewer => {
            let isLoaded = false;

            const observer = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting && !isLoaded && activeCount < maxActive) {
                    isLoaded = true;
                    activeCount++;
                    viewer.style.visibility = 'visible';
                    console.log(`Loading scene ${activeCount}/${maxActive}`);
                }
            }, {
                rootMargin: '100px',
                threshold: 0.1
            });

            observer.observe(viewer);

            // Start hidden for lazy loading
            viewer.style.visibility = 'hidden';
        });
    }

    // Initialize
    const count = initializeSplineViewers();
    if (count > 0) {
        setTimeout(setupLazyLoading, 100);
    }
});
</script>


<!-- ============================================
     3. PAGE-SPECIFIC CODE (Page Settings > Custom Code)
     ============================================ -->

<!-- Add this to: Page Settings → Custom Code → Before </body> tag -->
<!-- Only needed if you have page-specific interactions -->

<script>
// Page-specific hover text script (if you're using the type-trigger hover effect)
document.addEventListener('DOMContentLoaded', function() {
    const span = document.getElementById('typeSpan');
    if (!span) return;

    const defaultText = span.textContent;
    const triggers = document.querySelectorAll('.type-trigger');

    triggers.forEach(el => {
        const value = el.getAttribute('data-type');
        el.addEventListener('mouseenter', () => {
            if (value) span.textContent = value;
        });
        el.addEventListener('mouseleave', () => {
            span.textContent = defaultText;
        });
    });
});
</script>


<!-- ============================================
     4. EMBED CODE (In Webflow Designer)
     ============================================ -->

<!-- Your embed code stays EXACTLY THE SAME! -->
<!-- Just use canvas elements with data-spline-scene attributes -->

<!-- Example 1: Basic embed -->
<canvas
    id="allmountain-showcase"
    data-spline-scene="1000SKISALLMOUNTAIN">
</canvas>

<!-- Example 2: With container -->
<div class="type-trigger" data-type="All Mountain">
    <canvas
        id="allmountain-showcase"
        data-spline-scene="1000SKISALLMOUNTAIN">
    </canvas>
</div>

<!-- Example 3: All four skis -->
<canvas id="allmountain-showcase" data-spline-scene="1000SKISALLMOUNTAIN"></canvas>
<canvas id="park-showcase" data-spline-scene="1000SKISPARK"></canvas>
<canvas id="carve-showcase" data-spline-scene="1000SKISCARVE"></canvas>
<canvas id="powder-showcase" data-spline-scene="1000SKISPOWDER"></canvas>


<!-- ============================================
     SUMMARY
     ============================================ -->

<!--
WHAT HAPPENS:
1. Spline viewer loads ONCE from your CDN (in global head)
2. Global footer script automatically converts ALL canvas elements to spline-viewer
3. Your embed code stays simple - just canvas with data-spline-scene
4. Perfect high-DPI rendering (Spline's viewer handles it)
5. Fast loading from your Cloudflare CDN

BENEFITS:
✅ NO changes to your existing embeds
✅ Automatic conversion canvas → spline-viewer
✅ Perfect quality on Retina displays
✅ Everything from YOUR fast CDN
✅ Lazy loading for performance

TESTING:
Open browser console and you'll see:
- "✅ Initialized X Spline viewers"
- "Loading scene 1/4" (as you scroll)
-->