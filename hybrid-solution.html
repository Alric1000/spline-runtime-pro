<!-- HYBRID SOLUTION: Use Official Viewer with Cloudflare-hosted scenes -->

<style>
  /* Spline viewer styling */
  .spline-container {
    width: 100%;
    height: 100%;
    position: relative;
  }

  .spline-container iframe {
    width: 100%;
    height: 100%;
    border: none;
    display: block;
  }

  /* Disable selection */
  .spline-container {
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
  }
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const CLOUDFLARE_URL = 'https://spline-runtime-pro.pages.dev';
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const maxActiveScenes = isMobile ? 2 : 4;
    let activeScenes = new Map();

    // Create an iframe that uses Spline's viewer with your Cloudflare-hosted scenes
    function createSplineFrame(canvasId, scenePath) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) return;

        const container = canvas.parentElement;

        // Create iframe with Spline viewer
        const iframe = document.createElement('iframe');
        iframe.id = canvasId + '-frame';

        // Create a minimal HTML page that loads the Spline viewer
        const htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        spline-viewer { width: 100vw; height: 100vh; display: block; }
    </style>
    <script type="module" src="https://unpkg.com/@splinetool/viewer@1.10.57/build/spline-viewer.js"><\/script>
</head>
<body>
    <spline-viewer url="${CLOUDFLARE_URL}/scenes/${scenePath}/scene.splinecode"></spline-viewer>
</body>
</html>`;

        // Use srcdoc to embed the HTML directly
        iframe.srcdoc = htmlContent;
        iframe.style.width = '100%';
        iframe.style.height = '100%';
        iframe.style.border = 'none';

        // Replace canvas with iframe
        container.replaceChild(iframe, canvas);

        console.log(`âœ… Created Spline frame for ${scenePath}`);
        return iframe;
    }

    // Alternative: Create a dedicated viewer page on your Cloudflare
    function createViewerPage() {
        // Save this as viewer.html on your Cloudflare Pages
        return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spline Viewer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; }
        spline-viewer { width: 100vw; height: 100vh; display: block; }
    </style>
    <script type="module" src="https://unpkg.com/@splinetool/viewer@1.10.57/build/spline-viewer.js"></script>
</head>
<body>
    <spline-viewer id="viewer"></spline-viewer>
    <script>
        // Get scene from URL parameter
        const params = new URLSearchParams(window.location.search);
        const scene = params.get('scene');

        if (scene) {
            const viewer = document.getElementById('viewer');
            viewer.setAttribute('url', 'https://spline-runtime-pro.pages.dev/scenes/' + scene + '/scene.splinecode');
        }
    </script>
</body>
</html>`;
    }

    // Setup with iframe approach
    function setupSplineScenes() {
        document.querySelectorAll('[data-spline-scene]').forEach(canvas => {
            const scenePath = canvas.getAttribute('data-spline-scene');

            // Option 1: Direct iframe with srcdoc
            createSplineFrame(canvas.id, scenePath);

            // Option 2: Use dedicated viewer page (if you create viewer.html on Cloudflare)
            // const iframe = document.createElement('iframe');
            // iframe.src = `${CLOUDFLARE_URL}/viewer.html?scene=${scenePath}`;
            // canvas.parentElement.replaceChild(iframe, canvas);
        });
    }

    setupSplineScenes();
    console.log('ðŸŽ¯ Hybrid Spline solution initialized');
});
</script>

<!-- INSTRUCTION: Create this file on your Cloudflare Pages -->
<!-- File: viewer.html -->
<!-- Upload to: spline-runtime-pro.pages.dev/viewer.html -->
<!--
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spline Viewer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; background: transparent; }
        spline-viewer { width: 100vw; height: 100vh; display: block; }
    </style>
    <script type="module" src="https://unpkg.com/@splinetool/viewer@1.10.57/build/spline-viewer.js"></script>
</head>
<body>
    <spline-viewer id="viewer"></spline-viewer>
    <script>
        const params = new URLSearchParams(window.location.search);
        const scene = params.get('scene');

        if (scene) {
            const viewer = document.getElementById('viewer');
            const baseUrl = 'https://spline-runtime-pro.pages.dev';
            viewer.setAttribute('url', `${baseUrl}/scenes/${scene}/scene.splinecode`);
            console.log('Loading scene:', scene);
        }
    </script>
</body>
</html>
-->